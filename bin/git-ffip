#!/bin/sh

set -e

_pull_and_fast_forward() {
  (
    if test -z "$1"; then
      echo "Usage: git ffip [:|<branch>]" >&2
      return 1
    elif test "$1" = ':'; then
      _target_branch="$(git fb)"
      _target_branch="${_target_branch#refs/*/}"
    else
      _target_branch="$1"
    fi

    _source_branch="$(git branch --show-current)"
    shift 1

    (
      set -x
      git switch "$_target_branch"
      git pull
      git ff "$_source_branch" "$@"
      git push
    )
  )
}

_pull_and_fast_forward "$@"
