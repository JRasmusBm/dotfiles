#!/bin/bash

set -e

git_worktree_create() {
  if test -z "$1"; then
    echo "Usage: git wc <branch-name>" >&2
    exit 1
  fi

  _branch="$1"
  _common_git="$(git rev-parse --git-common-dir)"
  _root="$(dirname "$(cd "$_common_git" && pwd)")"
  _worktree_dir="${_root}/.worktrees/$(basename "$_branch")"

  (
    set -x
    git worktree add "$_worktree_dir" -b "$_branch"
  )
}

git_worktree_create "$@"
