#!/bin/sh

_tmux_attach() {
  all_sessions=$(tmux list-sessions | sed -E "s/:.*$//" | grep -v \"^"$(tmux display-message -p "#S")"\$\")
  speeddial_sessions=$(tr "\n " "|" <"$HOME/.tmux-speeddial" | tr -s '|')
  speeddial_sessions=${speeddial_sessions%?}
  speeddial_sessions="($speeddial_sessions)"
  filtered_sessions=$(echo "$all_sessions" | grep -vP "$speeddial_sessions")

  if test "$1" = 'all'; then
    target_session="$(echo "$all_sessions" | fzf --reverse | xargs)"
  else
    target_session="$(echo "$filtered_sessions" | fzf --reverse | xargs)"
  fi

  if [ -z "$TMUX" ]; then
    tmux attach -t "$target_session"
  else
    tmux switch-client -t "$target_session"
  fi
}

_tmux_attach "$@"
